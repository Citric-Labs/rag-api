import os
import datetime
from pymongo import MongoClient

from dotenv import load_dotenv

load_dotenv()

# connect to your Atlas cluster
client = MongoClient(os.getenv("MONGO_URI"))
db_name = os.getenv("DB_NAME")
collection_name = os.getenv("COLL_NAME")
collection = client[db_name][collection_name]

pipeline = [
    {'$vectorSearch': {
        'queryVector': [-0.08362551778554916, -0.030662324279546738, 0.01246396079659462, 0.012486457824707031,
                        -0.029822727665305138, 0.05581855773925781, -0.03131093084812164, 0.0030598656740039587,
                        0.009028477594256401, 0.03264186158776283, 0.0034106902312487364, 0.030799413099884987,
                        0.0063128359615802765, -0.01498199999332428, -0.05903215706348419, 0.054478295147418976,
                        -0.022092867642641068, -0.08124403655529022, 0.014614896848797798, 0.018182389438152313,
                        -0.017536131665110588, 0.06397552043199539, 0.02647428959608078, 0.06275515258312225,
                        0.0023773284628987312, -0.0345538891851902, 0.016796091571450233, 0.024344637989997864,
                        -0.06730439513921738, -0.03194881230592728, 0.03738873079419136, 0.14792832732200623,
                        0.020462747663259506, 0.009470578283071518, -0.010311194695532322, 0.03286360204219818,
                        0.06642745435237885, -0.07731004804372787, 0.02477186545729637, 0.015841713175177574,
                        -0.023772532120347023, -0.09353664517402649, 0.058662354946136475, -0.014201339334249496,
                        -0.032658278942108154, 0.02486809343099594, -0.08374256640672684, 0.049833592027425766,
                        0.03533456474542618, -0.005561700090765953, -0.0007816532743163407, -0.0002109222114086151,
                        -0.04578419402241707, -0.0010987449204549193, 0.006561506073921919, -0.088924840092659,
                        -0.10579986125230789, -0.08361434936523438, 0.07241802662611008, -0.10207267105579376,
                        0.09563440084457397, 0.0062026758678257465, -0.002351011848077178, 0.029119903221726418,
                        0.016950659453868866, 0.038304653018713, -0.02976473979651928, -0.07470979541540146,
                        0.014959149993956089, 0.024802234023809433, -0.05757572501897812, -0.009756659157574177,
                        -0.06193910911679268, -0.09515881538391113, -0.0340287871658802, -0.012067594565451145,
                        0.059946730732917786, -0.0483475923538208, -0.07567636668682098, -0.1407417207956314,
                        0.02061006985604763, -0.06846735626459122, -0.1582663208246231, 0.020382536575198174,
                        -0.03321225196123123, 0.028239136561751366, -0.016314085572957993, 0.07517515867948532,
                        -0.0025530012790113688, 0.07513302564620972, -0.08078160136938095, -0.04413853585720062,
                        0.07235171645879745, 0.01792214810848236, -0.07910249382257462, 0.05181555077433586,
                        -0.020126279443502426, 0.05485464632511139, 0.039731040596961975, 0.06127244979143143,
                        0.10030010342597961, -0.051438331604003906, -0.09339456260204315, 0.05185842141509056,
                        0.07850438356399536, -0.07994163036346436, 0.03661379963159561, 0.007134243845939636,
                        -0.000951989961322397, -0.03750436380505562, -0.006788531318306923, -0.1005716323852539,
                        -0.09902527928352356, -0.001255550654605031, -0.009432073682546616, -0.011794030666351318,
                        0.04316585883498192, 0.06404785811901093, -0.05445477366447449, -0.06642745435237885,
                        0.01316076423972845, 0.05232642590999603, -0.0227432269603014, -0.052020978182554245,
                        0.011949222534894943, -0.0622820109128952, -0.04153820872306824, -4.51980149285062e-33,
                        0.019252339377999306, -0.028496744111180305, 0.09934955835342407, 0.03397062420845032,
                        -0.0021725499536842108, -0.03355402871966362, -0.0077927797101438046, 0.06531314551830292,
                        -0.02398916520178318, -0.0024438942782580853, -0.06911145895719528, 0.030331898480653763,
                        0.03325177729129791, 0.0031497678719460964, 0.046045511960983276, 0.0014296779409050941,
                        0.007072586566209793, 0.031386252492666245, 0.044514503329992294, -0.018030451610684395,
                        0.007931412197649479, -0.01398419588804245, -0.04672761633992195, 0.024584827944636345,
                        0.013662225566804409, 0.04313155636191368, -0.0119249876588583, -0.023210637271404266,
                        -0.056868746876716614, -0.004019078332930803, -0.029226845130324364, 0.07429419457912445,
                        -0.004083519335836172, 0.0348130501806736, 0.05406058952212334, 0.024636680260300636,
                        0.0016364746261388063, -0.047675684094429016, -0.019074536859989166, 0.0070178029127418995,
                        -0.028727227821946144, 0.09198817610740662, -0.0991157814860344, 0.05438787862658501,
                        0.044310618191957474, 0.0068687074817717075, 0.04463246464729309, 0.010786009952425957,
                        0.010173771530389786, 0.108220674097538, -0.04004846140742302, 0.04346785321831703,
                        0.018969375640153885, -0.012677340768277645, 0.0075550018809735775, -0.061729833483695984,
                        -0.020348969846963882, 0.07636984437704086, 0.006147876847535372, 0.03944139555096626,
                        0.0490058958530426, 0.023193689063191414, -0.02137458324432373, -0.010752339847385883,
                        -0.012720751576125622, 0.0788341611623764, 0.02572457492351532, 0.054212816059589386,
                        -0.01464991644024849, 0.06592682003974915, -0.04018131643533707, -0.04311329871416092,
                        -0.013234813697636127, 0.007491688244044781, 0.05565107241272926, 0.037619173526763916,
                        0.025374725461006165, -0.12228687107563019, -0.008544592186808586, -4.430669287103228e-05,
                        -0.027608176693320274, -0.049811623990535736, 0.038174234330654144, -0.039799727499485016,
                        -0.001643593073822558, 0.002904098480939865, -0.007735009305179119, -0.03647780045866966,
                        0.07909627258777618, 0.00443441653624177, 0.011650647036731243, -0.09847399592399597,
                        -0.027642471715807915, -0.01804608851671219, -0.0230279378592968, 2.4350389354512687e-33,
                        0.019978400319814682, 0.03920477628707886, -0.08607335388660431, -0.02185778133571148,
                        0.020496217533946037, 0.027406856417655945, -0.06009029597043991, 0.051458582282066345,
                        0.021770449355244637, -0.011087737046182156, -0.01672697253525257, 0.06842298805713654,
                        0.11276240646839142, -0.02224643900990486, 0.009329044260084629, -0.050630804151296616,
                        0.026498883962631226, 0.016497258096933365, 0.0357678048312664, 0.06642238050699234,
                        -0.009056244045495987, 0.004603615030646324, -0.08443845063447952, -0.02153944782912731,
                        0.03352467715740204, 0.06735118478536606, 0.06878349930047989, -0.0507633313536644,
                        0.009241386316716671, -0.0545833483338356, -0.020118819549679756, -0.07332544773817062,
                        0.06410683691501617, 0.08256547152996063, 0.041853614151477814, -0.0019709474872797728,
                        0.052151989191770554, 0.027564814314246178, -0.016518402844667435, -0.03932853415608406,
                        -0.06742626428604126, 0.06819131225347519, 0.02016553469002247, 0.12775933742523193,
                        -0.020113280043005943, -0.044177066534757614, -0.056553684175014496, 0.11973162740468979,
                        -0.0774005800485611, 0.07934244722127914, -0.022219032049179077, -0.0006818627007305622,
                        -0.01919310912489891, -0.0516931489109993, -0.02294299565255642, -0.015379545278847218,
                        0.02619614265859127, 0.018427394330501556, 0.06256161630153656, 0.010447997599840164,
                        -0.026433207094669342, 0.0456877276301384, 0.004440015647560358, -0.02389039844274521,
                        -0.005517298821359873, -0.05507209151983261, 0.007886026054620743, 0.1294506937265396,
                        -0.08553580194711685, -0.017038339748978615, 0.034821558743715286, -0.054846808314323425,
                        -0.14455494284629822, -0.057699281722307205, 0.006463401485234499, -0.03479814901947975,
                        -0.011012939736247063, -0.003620087169110775, 0.07959017902612686, 0.02762417308986187,
                        -0.03281281143426895, 0.04144494980573654, 0.07049575448036194, 0.10019814968109131,
                        0.024545740336179733, 0.1137085109949112, 0.03415563330054283, 0.03796106576919556,
                        0.023373739793896675, 0.051735375076532364, -0.028785107657313347, -0.01700418069958687,
                        0.07591541111469269, -0.0010316063417121768, -0.027269963175058365, -1.7055240775221137e-08,
                        0.05879930034279823, 0.04922749102115631, -0.030453983694314957, -0.02257153019309044,
                        0.052111946046352386, 0.03470192104578018, -0.0633101612329483, 0.10424434393644333,
                        0.016638807952404022, 0.004861223045736551, 0.08528447151184082, -0.05149000138044357,
                        0.060361653566360474, -0.0007502866792492568, 0.006267435848712921, -0.0315389521420002,
                        -0.015697645023465157, -0.03349575772881508, -0.08517715334892273, 0.04557880759239197,
                        -0.04480760917067528, 0.042458560317754745, 0.04889076203107834, -0.07680346071720123,
                        0.03718402236700058, 0.045377522706985474, -0.008229532279074192, 0.02388744242489338,
                        0.019027313217520714, 0.015332717448472977, 0.009046806953847408, -0.024977408349514008,
                        -0.15408043563365936, -0.01786700449883938, -0.07056554406881332, -0.006941772531718016,
                        0.004153093323111534, -0.009867548942565918, -0.005163387395441532, -0.02182057686150074,
                        0.007372695486992598, -0.03479596972465515, -0.034089814871549606, 0.037453893572092056,
                        -0.012492054142057896, 0.03809727728366852, -0.044549811631441116, -0.19400513172149658,
                        -0.029243025928735733, -0.02288532815873623, -0.006934464443475008, -0.02321675978600979,
                        -0.06353364884853363, 0.04272361472249031, 0.019490888342261314, 0.06597068905830383,
                        -0.027526969090104103, -0.0030039441771805286, -0.07044380903244019, -0.0037579392082989216,
                        0.09111891686916351, 0.009645848535001278, -0.010783885605633259, 0.034288134425878525],
        'path': 'embedding', 'numCandidates': 40, 'limit': 4, 'index': 'movies_vector_index',
        'filter': {'$and': [{'genres': {'$eq': 'Action'}}, {'year': {'$gt': 2000}}, {'imdb.rating': {'$gt': 6}}]}}},
    {'$set': {'score': {'$meta': 'vectorSearchScore'}}}
]

# run pipeline
result = collection.aggregate(pipeline)

# print results
for i in result:
    print(i)
